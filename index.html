<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect Wallet</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.6.9/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>Connect Your Wallet</h1>
    <button id="connectButton">Connect MetaMask Wallet</button>
    <p id="walletAddress"></p>

    <script>
        document.getElementById('connectButton').addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    const network = await provider.getNetwork();

                    // Skale network configuration
                    const skaleChainId = 974399131; // Replace with your Skale network chain ID if different
                    const skaleRpcUrl = 'https://testnet.skalenodes.com/v1/giant-half-dual-testnet';
                    const skaleBlockExplorerUrl = 'https://giant-half-dual-testnet.explorer.testnet.skalenodes.com/';

                    // Convert chain ID to hexadecimal format
                    const skaleChainIdHex = `0x${skaleChainId.toString(16)}`;

                    // Check if MetaMask is connected to the correct Skale network
                    if (network.chainId !== skaleChainId) {
                        try {
                            // Open MetaMask app to switch network
                            const metaMaskDeepLink = `https://metamask.app.link/dapp/https://mors6960.github.io/SkaleWallet/`;
                            window.location.href = metaMaskDeepLink;
                            
                            // Inform user to switch networks manually if needed
                            alert("Please open the MetaMask app and switch to the Skale network. If MetaMask does not open, ensure it is installed and try again.");
                        } catch (addError) {
                            console.error("Error adding or switching network:", addError);
                        }
                    } else {
                        // Request account access
                        await provider.send("eth_requestAccounts", []);
                        const signer = provider.getSigner();
                        const address = await signer.getAddress();
                        document.getElementById('walletAddress').innerText = `Connected: ${address}`;

                        // Example: Fetch and display the sFUEL balance
                        const balance = await provider.getBalance(address);
                        // Convert balance from wei to sFUEL
                        const sFUELBalance = ethers.utils.formatUnits(balance, 18);
                        document.getElementById('walletAddress').innerText += `, Balance: ${sFUELBalance} sFUEL`;
                    }
                } catch (error) {
                    console.error("Error connecting wallet:", error);
                }
            } else {
                // MetaMask deep link for mobile if MetaMask is not found
                const metaMaskDeepLink = 'https://metamask.app.link/dapp/https://mors6960.github.io/SkaleWallet/';
                window.location.href = metaMaskDeepLink;
                
                // Inform user to install MetaMask
                alert("MetaMask is not installed. Please install MetaMask and try again.");
            }
        });
    </script>
</body>
</html>
