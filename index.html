<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MetaMask Integration</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    #status {
      margin-bottom: 20px;
      font-size: 18px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-right: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>MetaMask Integration</h1>
  <div id="status">Status: Not Connected</div>
  <button onclick="connect()">Connect</button>

  <script>
    const defaultChainId = '0x3a14269b'; // Default chain ID (hexadecimal)
    const defaultRpcUrl = 'https://testnet.skalenodes.com/v1/giant-half-dual-testnet'; // Default RPC URL
    const defaultBlockExplorerUrls = 'https://giant-half-dual-testnet.explorer.testnet.skalenodes.com/';
    const defaultCurrentSymbol = 'SKL'; // Use uppercase to avoid confusion
    const defaultChainName = 'Calypso Hub';

    async function connect() {
      try {
        if (window.ethereum) {
          // Request MetaMask connection
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          console.log('Connected accounts:', accounts);
          updateStatus('Connected');

          // Switch to default chain if needed
          const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });
          if (currentChainId !== defaultChainId) {
            try {
              await window.ethereum.request({
                method: 'wallet_switchEthereumChain',
                params: [{ chainId: defaultChainId }],
              });
              updateStatus('Switched to Default Chain');
            } catch (switchError) {
              if (switchError.code === 4902) {
                // Add chain if not present
                await window.ethereum.request({
                  method: 'wallet_addEthereumChain',
                  params: [{
                    chainId: defaultChainId,
                    chainName: defaultChainName,
                    rpcUrls: [defaultRpcUrl],
                    blockExplorerUrls: [defaultBlockExplorerUrls],
                    nativeCurrency: {
                      name: 'SKL',
                      symbol: defaultCurrentSymbol,
                      decimals: 18
                    },
                  }],
                });
                updateStatus('Chain Added');
              } else {
                console.error('Switch Chain Error:', switchError);
                updateStatus('Failed to Switch Chain');
              }
            }
          } else {
            updateStatus('Already on Default Chain');
          }
        } else {
          updateStatus('MetaMask not installed');
        }
      } catch (e) {
        console.error('Connection Error:', e);
        updateStatus('Connection Failed');
      }
    }

    function updateStatus(text) {
      document.getElementById('status').innerText = `Status: ${text}`;
    }
  </script>
</body>
</html>
